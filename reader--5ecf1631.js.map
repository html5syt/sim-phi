{"version":3,"file":"reader--5ecf1631.js","sources":["../src/extends/pec/easing.js","../src/extends/pec/BpmList.ts","../src/extends/pec/LinePec.ts","../src/extends/pec/cubicBezier.js","../src/extends/pec/rpe2json.ts","../src/extends/pec/index.ts","../src/extends/pec/pec2json.ts","../src/utils/reader-.ts"],"sourcesContent":["/* eslint-disable no-param-reassign */\nconst tl = [\n  null, // 0\n  null, // 1\n  t => Math.sin(t * Math.PI / 2), // 2\n  t => 1 - Math.cos(t * Math.PI / 2), // 3\n  t => 1 - (t - 1) ** 2, // 4\n  t => t ** 2, // 5\n  t => (1 - Math.cos(t * Math.PI)) / 2, // 6\n  t => ((t *= 2) < 1 ? t ** 2 : -((t - 2) ** 2 - 2)) / 2, // 7\n  t => 1 + (t - 1) ** 3, // 8\n  t => t ** 3, // 9\n  t => 1 - (t - 1) ** 4, // 10\n  t => t ** 4, // 11\n  t => ((t *= 2) < 1 ? t ** 3 : (t - 2) ** 3 + 2) / 2, // 12\n  t => ((t *= 2) < 1 ? t ** 4 : -((t - 2) ** 4 - 2)) / 2, // 13\n  t => 1 + (t - 1) ** 5, // 14\n  t => t ** 5, // 15\n  t => 1 - 2 ** (-10 * t), // 16\n  t => 2 ** (10 * (t - 1)), // 17\n  t => Math.sqrt(1 - (t - 1) ** 2), // 18\n  t => 1 - Math.sqrt(1 - t ** 2), // 19\n  t => (2.70158 * t - 1) * (t - 1) ** 2 + 1, // 20\n  t => (2.70158 * t - 1.70158) * t ** 2, // 21\n  t => ((t *= 2) < 1 ? 1 - Math.sqrt(1 - t ** 2) : Math.sqrt(1 - (t - 2) ** 2) + 1) / 2, // 22\n  t => t < 0.5 ? (14.379638 * t - 5.189819) * t ** 2 : (14.379638 * t - 9.189819) * (t - 1) ** 2 + 1, // 23\n  t => 1 - 2 ** (-10 * t) * Math.cos(t * Math.PI / 0.15), // 24\n  t => 2 ** (10 * (t - 1)) * Math.cos((t - 1) * Math.PI / 0.15), // 25\n  t => ((t *= 11) < 4 ? t ** 2 : t < 8 ? (t - 6) ** 2 + 12 : t < 10 ? (t - 9) ** 2 + 15 : (t - 10.5) ** 2 + 15.75) / 16, // 26\n  t => 1 - tl[26](1 - t), // 27\n  t => (t *= 2) < 1 ? tl[26](t) / 2 : tl[27](t - 1) / 2 + 0.5, // 28\n  t => t < 0.5 ? 2 ** (20 * t - 11) * Math.sin((160 * t + 1) * Math.PI / 18) : 1 - 2 ** (9 - 20 * t) * Math.sin((160 * t + 1) * Math.PI / 18) // 29\n];\nfunction isLinear(index) {\n  index = Math.trunc(index);\n  return index < 2 || index > 29;\n}\n/**\n * @param {number} index\n * @returns {((t: number) => number) | null}\n */\nfunction easing(index) {\n  index = Math.trunc(index);\n  return tl[index];\n}\nexport { isLinear, easing };\n","interface BpmEventPec {\n  start: number;\n  end: number;\n  bpm: number;\n  value: number;\n}\nexport type BeatArray = [number, number, number];\nexport class BpmList {\n  public baseBpm: number;\n  private accTime: number;\n  private readonly list: BpmEventPec[];\n  public constructor(baseBpm: unknown) {\n    this.baseBpm = Number(baseBpm) || 120;\n    this.accTime = 0;\n    this.list = []; // 存放bpm变速事件\n  }\n  public push(start: number, end: number, bpm: number): void {\n    const value = this.accTime;\n    this.list.push({ start, end, bpm, value });\n    this.accTime += (end - start) / bpm;\n  }\n  public calc(beat: number): number {\n    let time = 0;\n    for (const i of this.list) {\n      if (beat > i.end) { continue }\n      if (beat < i.start) { break }\n      time = Math.round(((beat - i.start) / i.bpm + i.value) * this.baseBpm * 32);\n    }\n    return time;\n  }\n  public calc2(time: BeatArray): number {\n    return this.calc(time[0] + time[1] / time[2]);\n  }\n}\n","import { easing } from './easing.js';\ninterface SpeedEventPec {\n  time: number;\n  value: number;\n}\ninterface NotePecExtends {\n  type: number;\n  time: number;\n  positionX: number;\n  holdTime: number;\n  speed: number;\n  isAbove: boolean;\n  isFake: boolean;\n}\ninterface LineEventPec {\n  startTime: number;\n  endTime: number;\n  value: number;\n  motionType: number;\n}\ninterface LineEventPecExtends extends LineEventPec {\n  value2: number;\n}\nexport class LinePec {\n  private readonly bpm: number;\n  private readonly speedEvents: SpeedEventPec[];\n  private readonly notes: NotePecExtends[];\n  private readonly alphaEvents: LineEventPec[];\n  private readonly moveEvents: LineEventPecExtends[];\n  private readonly rotateEvents: LineEventPec[];\n  public constructor(bpm: number) {\n    this.bpm = 120;\n    this.speedEvents = [];\n    this.notes = [];\n    this.alphaEvents = [];\n    this.moveEvents = [];\n    this.rotateEvents = [];\n    if (!isNaN(bpm)) { this.bpm = bpm }\n  }\n  public pushNote(type: number, time: number, positionX: number, holdTime: number, speed: number, isAbove: boolean, isFake: boolean): void {\n    this.notes.push({ type, time, positionX, holdTime, speed, isAbove, isFake });\n  }\n  public pushSpeedEvent(time: number, value: number): void {\n    this.speedEvents.push({ time, value });\n  }\n  public pushAlphaEvent(startTime: number, endTime: number, value: number, motionType: number): void {\n    this.alphaEvents.push({ startTime, endTime, value, motionType });\n  }\n  public pushMoveEvent(startTime: number, endTime: number, value: number, value2: number, motionType: number): void {\n    this.moveEvents.push({ startTime, endTime, value, value2, motionType });\n  }\n  public pushRotateEvent(startTime: number, endTime: number, value: number, motionType: number): void {\n    this.rotateEvents.push({ startTime, endTime, value, motionType });\n  }\n  public format(): JudgeLine {\n    const sortFn = (a: { time: number }, b: { time: number }) => a.time - b.time;\n    const sortFn2 = (a: { startTime: number; endTime: number }, b: { startTime: number; endTime: number }) => a.startTime - b.startTime + (a.endTime - b.endTime);\n    // 不单独判断以避免误差\n    const result = {\n      formatVersion: 3,\n      offset: 0,\n      bpm: this.bpm,\n      speedEvents: [] as SpeedEvent[],\n      numOfNotes: 0,\n      numOfNotesAbove: 0,\n      numOfNotesBelow: 0,\n      notesAbove: [] as Note[],\n      notesBelow: [] as Note[],\n      judgeLineDisappearEvents: [] as JudgeLineEvent[],\n      judgeLineMoveEvents: [] as JudgeLineEvent[],\n      judgeLineRotateEvents: [] as JudgeLineEvent[]\n    };\n    const pushDisappearEvent = (startTime: number, endTime: number, start: number, end: number) => {\n      result.judgeLineDisappearEvents.push({ startTime, endTime, start, end, start2: 0, end2: 0 });\n    };\n    const pushMoveEvent = (startTime: number, endTime: number, start: number, end: number, start2: number, end2: number) => {\n      result.judgeLineMoveEvents.push({ startTime, endTime, start, end, start2, end2 });\n    };\n    const pushRotateEvent = (startTime: number, endTime: number, start: number, end: number) => {\n      result.judgeLineRotateEvents.push({ startTime, endTime, start, end, start2: 0, end2: 0 });\n    };\n    // cv和floorPosition一并处理\n    const cvp = this.speedEvents.sort(sortFn);\n    let s1 = 0;\n    for (let i = 0; i < cvp.length; i++) {\n      const startTime = Math.max(cvp[i].time, 0);\n      const endTime = i < cvp.length - 1 ? cvp[i + 1].time : 1e9;\n      const { value } = cvp[i];\n      const floorPosition = s1;\n      s1 += (endTime - startTime) * value / this.bpm * 1.875;\n      s1 = Math.fround(s1);\n      result.speedEvents.push({ startTime, endTime, value, floorPosition });\n    }\n    for (const i of this.notes.sort(sortFn)) {\n      const { time } = i;\n      let v1 = 0;\n      let v2 = 0;\n      let v3 = 0;\n      for (const e of result.speedEvents) {\n        if (time > e.endTime) { continue }\n        if (time < e.startTime) { break }\n        v1 = e.floorPosition;\n        v2 = e.value;\n        v3 = time - e.startTime;\n      }\n      const note = {\n        type: i.type,\n        time: time + (i.isFake ? 1e9 : 0),\n        positionX: i.positionX,\n        holdTime: i.holdTime,\n        speed: i.speed * (i.type === 3 ? v2 : 1),\n        floorPosition: Math.fround(v1 + v2 * v3 / this.bpm * 1.875)\n      };\n      if (i.isAbove) {\n        result.notesAbove.push(note);\n        if (i.isFake) { continue }\n        result.numOfNotes++;\n        result.numOfNotesAbove++;\n      } else {\n        result.notesBelow.push(note);\n        if (i.isFake) { continue }\n        result.numOfNotes++;\n        result.numOfNotesBelow++;\n      }\n    }\n    // 整合motionType\n    let dt = 0;\n    let d1 = 0;\n    for (const e of this.alphaEvents.sort(sortFn2)) {\n      pushDisappearEvent(dt, e.startTime, d1, d1);\n      const easingFn = easing(e.motionType);\n      if (easingFn != null) {\n        const t1 = e.value - d1;\n        let x1 = 0;\n        let x2 = 0;\n        for (let i = e.startTime; i < e.endTime; i++) {\n          x1 = x2;\n          x2 = easingFn((i + 1 - e.startTime) / (e.endTime - e.startTime));\n          pushDisappearEvent(i, i + 1, d1 + x1 * t1, d1 + x2 * t1);\n        }\n      } else if (e.motionType) pushDisappearEvent(e.startTime, e.endTime, d1, e.value);\n      dt = e.endTime;\n      d1 = e.value;\n    }\n    pushDisappearEvent(dt, 1e9, d1, d1);\n    //\n    let mt = 0;\n    let m1 = 0;\n    let m2 = 0;\n    for (const e of this.moveEvents.sort(sortFn2)) {\n      pushMoveEvent(mt, e.startTime, m1, m1, m2, m2);\n      const easingFn = easing(e.motionType);\n      if (easingFn != null) {\n        const t1 = e.value - m1;\n        const t2 = e.value2 - m2;\n        let x1 = 0;\n        let x2 = 0;\n        for (let i = e.startTime; i < e.endTime; i++) {\n          x1 = x2;\n          x2 = easingFn((i + 1 - e.startTime) / (e.endTime - e.startTime));\n          pushMoveEvent(i, i + 1, m1 + x1 * t1, m1 + x2 * t1, m2 + x1 * t2, m2 + x2 * t2);\n        }\n      } else if (e.motionType === 1) pushMoveEvent(e.startTime, e.endTime, m1, e.value, m2, e.value2);\n      mt = e.endTime;\n      m1 = e.value;\n      m2 = e.value2;\n    }\n    pushMoveEvent(mt, 1e9, m1, m1, m2, m2);\n    //\n    let rt = 0;\n    let r1 = 0;\n    for (const e of this.rotateEvents.sort(sortFn2)) {\n      pushRotateEvent(rt, e.startTime, r1, r1);\n      const easingFn = easing(e.motionType);\n      if (easingFn != null) {\n        const t1 = e.value - r1;\n        let x1 = 0;\n        let x2 = 0;\n        for (let i = e.startTime; i < e.endTime; i++) {\n          x1 = x2;\n          x2 = easingFn((i + 1 - e.startTime) / (e.endTime - e.startTime));\n          pushRotateEvent(i, i + 1, r1 + x1 * t1, r1 + x2 * t1);\n        }\n      } else if (e.motionType === 1) pushRotateEvent(e.startTime, e.endTime, r1, e.value);\n      rt = e.endTime;\n      r1 = e.value;\n    }\n    pushRotateEvent(rt, 1e9, r1, r1);\n    return result;\n  }\n}\n","export function cubicBezier(p1x, p1y, p2x, p2y) {\n  const ZERO_LIMIT = 1e-6;\n  // Calculate the polynomial coefficients,\n  // implicit first and last control points are (0,0) and (1,1).\n  const ax = 3 * p1x - 3 * p2x + 1;\n  const bx = 3 * p2x - 6 * p1x;\n  const cx = 3 * p1x;\n  const ay = 3 * p1y - 3 * p2y + 1;\n  const by = 3 * p2y - 6 * p1y;\n  const cy = 3 * p1y;\n  function sampleCurveDerivativeX(t) {\n    // `ax t^3 + bx t^2 + cx t` expanded using Horner's rule\n    return (3 * ax * t + 2 * bx) * t + cx;\n  }\n  function sampleCurveX(t) {\n    return ((ax * t + bx) * t + cx) * t;\n  }\n  function sampleCurveY(t) {\n    return ((ay * t + by) * t + cy) * t;\n  }\n  // Given an x value, find a parametric value it came from.\n  function solveCurveX(x) {\n    let t2 = x;\n    let derivative, x2;\n    // https://trac.webkit.org/browser/trunk/Source/WebCore/platform/animation\n    // first try a few iterations of Newton's method -- normally very fast.\n    // http://en.wikipedia.org/wikiNewton's_method\n    for (let i = 0; i < 8; i++) {\n      // f(t) - x = 0\n      x2 = sampleCurveX(t2) - x;\n      if (Math.abs(x2) < ZERO_LIMIT) {\n        return t2;\n      }\n      derivative = sampleCurveDerivativeX(t2);\n      // == 0, failure\n      if (Math.abs(derivative) < ZERO_LIMIT) {\n        break;\n      }\n      t2 -= x2 / derivative;\n    }\n    // Fall back to the bisection method for reliability.\n    // bisection\n    // http://en.wikipedia.org/wiki/Bisection_method\n    let t1 = 1;\n    let t0 = 0;\n    t2 = x;\n    while (t1 > t0) {\n      x2 = sampleCurveX(t2) - x;\n      if (Math.abs(x2) < ZERO_LIMIT) {\n        return t2;\n      }\n      if (x2 > 0) {\n        t1 = t2;\n      } else {\n        t0 = t2;\n      }\n      t2 = (t1 + t0) / 2;\n    }\n    // Failure\n    return t2;\n  }\n  function solve(x) {\n    return sampleCurveY(solveCurveX(x));\n  }\n  return solve;\n}\n","/* eslint-disable @typescript-eslint/naming-convention */\nimport { type BeatArray, BpmList } from './BpmList';\nimport { easing } from './easing.js';\nimport { cubicBezier } from './cubicBezier.js';\ninterface BpmEventRPE {\n  startTime: BeatArray;\n  bpm: number;\n}\ninterface BpmEventRPEExtends extends BpmEventRPE {\n  time: number;\n}\ninterface LineEventPec {\n  startTime: number;\n  endTime: number;\n  start: number;\n  end: number;\n}\ninterface LineEventPec2 extends LineEventPec {\n  start2: number;\n  end2: number;\n}\ninterface LineEventPecDelta extends LineEventPec {\n  delta: number;\n}\ninterface SpeedEventPec {\n  time: number;\n  value: number;\n}\ninterface LineEventRPE {\n  startTime: BeatArray;\n  endTime: BeatArray;\n  start: number;\n  end: number;\n  easingType: number;\n  linkgroup?: number;\n  easingLeft?: number;\n  easingRight?: number;\n  bezier?: number;\n  bezierPoints?: [number, number, number, number];\n}\ninterface LineEventRPE2 {\n  startTime: number;\n  endTime: number;\n  start: number;\n  end: number;\n  easingFn?: (t: number) => number;\n}\nconst enum EasingCode {\n  NoError = 0,\n  StartEqualsEnd = -1,\n  EasingTypeNotSupported = -2,\n  LinearBezier = -3\n}\ninterface EasingResult {\n  code: EasingCode;\n  fn?: (t: number) => number;\n}\nfunction getEasingFn(le: LineEventRPE, startTime: number, endTime: number): EasingResult {\n  const { start, end, bezier = 0 } = le;\n  if (start === end) return { code: EasingCode.StartEqualsEnd };\n  if (bezier === 0) {\n    const { easingType, easingLeft = 0, easingRight = 1 } = le;\n    const easingFn = easing(easingType);\n    if (easingFn == null) return { code: EasingCode.EasingTypeNotSupported };\n    const eHead = easingFn(easingLeft);\n    const eTail = easingFn(easingRight);\n    const eSpeed = (easingRight - easingLeft) / (endTime - startTime);\n    const eDelta = (eTail - eHead) / (end - start);\n    return { code: EasingCode.NoError, fn: (t: number) => (easingFn((t - startTime) * eSpeed + easingLeft) - eHead) / eDelta };\n  }\n  if (bezier !== 0) {\n    const { bezierPoints: [p1x, p1y, p2x, p2y] = [0, 0, 0, 0] } = le;\n    if (p1x === p1y && p2x === p2y) return { code: EasingCode.LinearBezier };\n    const eSpeed = 1 / (endTime - startTime);\n    const eDelta = 1 / (end - start);\n    const easingFn = cubicBezier(p1x, p1y, p2x, p2y);\n    return { code: EasingCode.NoError, fn: (t: number) => easingFn((t - startTime) * eSpeed) / eDelta };\n  }\n  throw new Error('Not implemented');\n}\nfunction pushLineEvent(ls: LineEventPecDelta[], le: LineEventRPE2) {\n  const { startTime, endTime, start, end, easingFn } = le;\n  const delta = (end - start) / (endTime - startTime);\n  // 插入之前考虑事件时间的相互关系\n  for (let i = ls.length - 1; i >= 0; i--) {\n    const e = ls[i];\n    if (e.endTime < startTime) { // 相离：补全空隙\n      ls[i + 1] = { startTime: e.endTime, endTime: startTime, start: e.end, end: e.end, delta: 0 };\n      break;\n    }\n    if (e.startTime === startTime) { // 相切：直接截断\n      ls.length = i;\n      break;\n    }\n    if (e.startTime < startTime) { // 相交：截断交点以后的部分\n      e.end = e.start + (startTime - e.startTime) * e.delta;\n      e.endTime = startTime;\n      e.delta = (e.end - e.start) / (startTime - e.startTime);\n      ls.length = i + 1;\n      break;\n    }\n  }\n  // 插入新事件\n  if (startTime >= endTime) {\n    ls.push({ startTime, endTime: startTime, start: end, end, delta: 0 });\n    return;\n  }\n  if (easingFn == null) {\n    ls.push({ startTime, endTime, start, end, delta });\n  } else {\n    let v1 = 0;\n    let v2 = 0;\n    for (let j = startTime; j < endTime; j++) {\n      v1 = v2;\n      v2 = easingFn(j + 1);\n      ls.push({ startTime: j, endTime: j + 1, start: start + v1, end: start + v2, delta: v2 - v1 });\n    }\n  }\n}\nfunction toSpeedEvent(le: LineEventRPE2[]) {\n  const result = [];\n  for (const i of le) {\n    const { startTime, endTime, start, end } = i;\n    result.push({ time: startTime, value: start });\n    if (start !== end) { // 暂未考虑开始时间大于结束时间的情况\n      const t1 = (end - start) / (endTime - startTime);\n      for (let j = startTime; j < endTime; j++) {\n        const x = j + 1 - startTime;\n        result.push({ time: j + 1, value: start + x * t1 });\n      }\n    }\n  }\n  return result;\n}\nfunction getEventsValue(e: LineEventPecDelta[], t: number, d: boolean) {\n  let result = e[0]?.start ?? 0;\n  for (const i of e) {\n    const { startTime, endTime, start, end, delta } = i;\n    if (t < startTime) break;\n    if (d && t === startTime) break;\n    if (t >= endTime) result = end;\n    else result = start + (t - startTime) * delta;\n  }\n  return result;\n}\nfunction getMoveValue(e: LineEventPec2[], t: number, d: boolean) {\n  let result = e[0]?.start ?? 0;\n  let result2 = e[0]?.start2 ?? 0;\n  for (const i of e) {\n    const { startTime, endTime, start, end, start2, end2 } = i;\n    if (t < startTime) break;\n    if (d && t === startTime) break;\n    if (t >= endTime) {\n      result = end;\n      result2 = end2;\n    } else {\n      result = start + (t - startTime) * (end - start) / (endTime - startTime);\n      result2 = start2 + (t - startTime) * (end2 - start2) / (endTime - startTime);\n    }\n  }\n  return [result, result2];\n}\nfunction getRotateValue(e: LineEventRPE2[], t: number, d: boolean) {\n  let result = e[0]?.start ?? 0;\n  for (const i of e) {\n    const { startTime, endTime, start, end } = i;\n    if (t < startTime) break;\n    if (d && t === startTime) break;\n    if (t >= endTime) result = end;\n    else { result = start + (t - startTime) * (end - start) / (endTime - startTime) }\n  }\n  return result;\n}\nfunction combineXYEvents(xe: LineEventPecDelta[], ye: LineEventPecDelta[]) {\n  const le = [];\n  const splits = [];\n  for (const i of xe) splits.push(i.startTime, i.endTime);\n  for (const i of ye) splits.push(i.startTime, i.endTime);\n  splits.sort((a, b) => a - b);\n  for (let i = 0; i < splits.length - 1; i++) {\n    const startTime = splits[i];\n    const endTime = splits[i + 1];\n    if (startTime === endTime) continue;\n    const startX = getEventsValue(xe, startTime, false);\n    const endX = getEventsValue(xe, endTime, true);\n    const startY = getEventsValue(ye, startTime, false);\n    const endY = getEventsValue(ye, endTime, true);\n    le.push({ startTime, endTime, start: startX, end: endX, start2: startY, end2: endY });\n  }\n  return le;\n}\nfunction combineMultiEvents(es: LineEventPecDelta[][]) {\n  const le = [];\n  const splits = [];\n  for (const e of es) {\n    for (const i of e) splits.push(i.startTime, i.endTime);\n  }\n  splits.sort((a, b) => a - b);\n  for (let i = 0; i < splits.length - 1; i++) {\n    const startTime = splits[i];\n    const endTime = splits[i + 1];\n    if (startTime === endTime) continue;\n    const start = es.reduce((n, e) => n + getEventsValue(e, startTime, false), 0);\n    const end = es.reduce((n, e) => n + getEventsValue(e, endTime, true), 0);\n    le.push({ startTime, endTime, start, end, delta: (end - start) / (endTime - startTime) });\n  }\n  return le;\n}\nfunction mergeFather(child: LineRPE1, father: LineRPE1) {\n  const moveEvents = [];\n  const splits = [];\n  for (const i of father.moveEvents!) splits.push(i.startTime, i.endTime);\n  for (const i of father.rotateEvents!) splits.push(i.startTime, i.endTime);\n  for (const i of child.moveEvents!) splits.push(i.startTime, i.endTime);\n  splits.sort((a, b) => a - b);\n  for (let i = splits[0]; i < splits[splits.length - 1]; i++) {\n    const startTime = i;\n    const endTime = i + 1;\n    if (startTime === endTime) continue;\n    // 计算父级移动和旋转\n    const [fatherX, fatherY] = getMoveValue(father.moveEvents!, startTime, false);\n    const fatherR = getRotateValue(father.rotateEvents!, startTime, false) * -Math.PI / 180;\n    const [fatherX2, fatherY2] = getMoveValue(father.moveEvents!, endTime, true);\n    const fatherR2 = getRotateValue(father.rotateEvents!, endTime, true) * -Math.PI / 180;\n    // 计算子级移动\n    const [childX, childY] = getMoveValue(child.moveEvents!, startTime, false);\n    const [childX2, childY2] = getMoveValue(child.moveEvents!, endTime, true);\n    // 坐标转换\n    const start = fatherX + childX * Math.cos(fatherR) - childY * Math.sin(fatherR);\n    const end = fatherX2 + childX2 * Math.cos(fatherR2) - childY2 * Math.sin(fatherR2);\n    const start2 = fatherY + childX * Math.sin(fatherR) + childY * Math.cos(fatherR);\n    const end2 = fatherY2 + childX2 * Math.sin(fatherR2) + childY2 * Math.cos(fatherR2);\n    moveEvents.push({ startTime, endTime, start, end, start2, end2 });\n  }\n  child.moveEvents = moveEvents;\n}\ninterface EventLayer {\n  moveXEvents: LineEventRPE[];\n  moveYEvents: LineEventRPE[];\n  rotateEvents: LineEventRPE[];\n  alphaEvents: LineEventRPE[];\n  speedEvents: LineEventRPE[];\n}\nclass EventLayer1 {\n  public moveXEvents: LineEventRPE2[];\n  public moveYEvents: LineEventRPE2[];\n  public rotateEvents: LineEventRPE2[];\n  public alphaEvents: LineEventRPE2[];\n  public speedEvents: LineEventRPE2[];\n  public constructor() {\n    this.moveXEvents = [];\n    this.moveYEvents = [];\n    this.rotateEvents = [];\n    this.alphaEvents = [];\n    this.speedEvents = [];\n  }\n  public pushMoveXEvent(startTime: number, endTime: number, start: number, end: number, easingFn?: (t: number) => number) {\n    this.moveXEvents.push({ startTime, endTime, start, end, easingFn });\n  }\n  public pushMoveYEvent(startTime: number, endTime: number, start: number, end: number, easingFn?: (t: number) => number) {\n    this.moveYEvents.push({ startTime, endTime, start, end, easingFn });\n  }\n  public pushRotateEvent(startTime: number, endTime: number, start: number, end: number, easingFn?: (t: number) => number) {\n    this.rotateEvents.push({ startTime, endTime, start, end, easingFn });\n  }\n  public pushAlphaEvent(startTime: number, endTime: number, start: number, end: number, easingFn?: (t: number) => number) {\n    this.alphaEvents.push({ startTime, endTime, start, end, easingFn });\n  }\n  public pushSpeedEvent(startTime: number, endTime: number, start: number, end: number) { this.speedEvents.push({ startTime, endTime, start, end }) }\n}\ninterface NoteRPE {\n  type: number;\n  startTime: BeatArray;\n  endTime: BeatArray;\n  positionX: number;\n  above: number;\n  isFake: number;\n  speed: number;\n  size: number;\n  yOffset: number;\n  visibleTime: number;\n  alpha: number;\n}\ninterface NoteRPE1 {\n  type: number;\n  time: number;\n  positionX: number;\n  holdTime: number;\n  speed: number;\n  isAbove: boolean;\n  isFake: boolean;\n}\nclass LineRPE1 {\n  public bpm: number;\n  public notes: NoteRPE1[];\n  public eventLayers: EventLayer1[];\n  public id?: number;\n  public father: LineRPE1 | null;\n  public moveEvents?: LineEventPec2[];\n  public rotateEvents?: LineEventPec[];\n  public alphaEvents?: LineEventPec[];\n  public speedEvents?: SpeedEventPec[];\n  private settled: boolean;\n  private merged: boolean;\n  public constructor(bpm: number) {\n    this.bpm = 120;\n    this.notes = [];\n    this.eventLayers = [];\n    this.father = null;\n    this.settled = false;\n    this.merged = false;\n    if (!isNaN(bpm)) this.bpm = bpm;\n  }\n  public pushNote(type: number, time: number, positionX: number, holdTime: number, speed: number, isAbove: boolean, isFake: boolean) {\n    this.notes.push({ type, time, positionX, holdTime, speed, isAbove, isFake });\n  }\n  public setId(id = NaN) { this.id = id }\n  public setFather(fatherLine: LineRPE1 | null) { this.father = fatherLine }\n  public preset() {\n    const sortFn2 = (a: { startTime: number }, b: { startTime: number }) => a.startTime - b.startTime;\n    const events = [];\n    for (const e of this.eventLayers) {\n      const moveXEvents: LineEventPecDelta[] = [];\n      const moveYEvents: LineEventPecDelta[] = [];\n      const rotateEvents: LineEventPecDelta[] = [];\n      const alphaEvents: LineEventPecDelta[] = [];\n      const speedEvents: LineEventPecDelta[] = [];\n      for (const i of e.moveXEvents.sort(sortFn2)) pushLineEvent(moveXEvents, i);\n      for (const i of e.moveYEvents.sort(sortFn2)) pushLineEvent(moveYEvents, i);\n      for (const i of e.rotateEvents.sort(sortFn2)) pushLineEvent(rotateEvents, i);\n      for (const i of e.alphaEvents.sort(sortFn2)) pushLineEvent(alphaEvents, i);\n      for (const i of e.speedEvents.sort(sortFn2)) pushLineEvent(speedEvents, i); // TODO: 特殊处理\n      events.push({ moveXEvents, moveYEvents, rotateEvents, alphaEvents, speedEvents });\n    }\n    const moveXEvents = combineMultiEvents(events.map(i => i.moveXEvents));\n    const moveYEvents = combineMultiEvents(events.map(i => i.moveYEvents));\n    this.moveEvents = combineXYEvents(moveXEvents, moveYEvents);\n    this.rotateEvents = combineMultiEvents(events.map(i => i.rotateEvents));\n    this.alphaEvents = combineMultiEvents(events.map(i => i.alphaEvents));\n    this.speedEvents = toSpeedEvent(combineMultiEvents(events.map(i => i.speedEvents)));\n    this.settled = true;\n  }\n  public fitFather(stack: LineRPE1[] = [], onwarning = console.warn) {\n    if (!this.settled) this.preset();\n    if (stack.includes(this)) {\n      onwarning(`检测到循环继承：${stack.concat(this).map(i => i.id).join('->')}(对应的father将被视为-1)`);\n      stack.map(i => i.setFather(null));\n      return;\n    }\n    if (this.father) this.father.fitFather(stack.concat(this), onwarning);\n    // this.father可能会在上一行被修改成null\n    if (this.father && !this.merged) {\n      mergeFather(this, this.father);\n      this.merged = true;\n    }\n  }\n  public format({ onwarning = console.warn } = {}) {\n    this.fitFather([], onwarning);\n    const result = {\n      bpm: this.bpm,\n      speedEvents: [] as SpeedEvent[],\n      numOfNotes: 0,\n      numOfNotesAbove: 0,\n      numOfNotesBelow: 0,\n      notesAbove: [] as Note[],\n      notesBelow: [] as Note[],\n      judgeLineDisappearEvents: [] as JudgeLineEvent[],\n      judgeLineMoveEvents: [] as JudgeLineEvent[],\n      judgeLineRotateEvents: [] as JudgeLineEvent[]\n    };\n    for (const i of this.moveEvents!) {\n      result.judgeLineMoveEvents.push({\n        startTime: i.startTime,\n        endTime: i.endTime,\n        start: (i.start + 675) / 1350,\n        end: (i.end + 675) / 1350,\n        start2: (i.start2 + 450) / 900,\n        end2: (i.end2 + 450) / 900\n      });\n    }\n    for (const i of this.rotateEvents!) {\n      result.judgeLineRotateEvents.push({\n        startTime: i.startTime,\n        endTime: i.endTime,\n        start: -i.start,\n        end: -i.end,\n        start2: 0,\n        end2: 0\n      });\n    }\n    for (const i of this.alphaEvents!) {\n      result.judgeLineDisappearEvents.push({\n        startTime: i.startTime,\n        endTime: i.endTime,\n        start: Math.max(0, i.start / 255),\n        end: Math.max(0, i.end / 255),\n        start2: 0,\n        end2: 0\n      });\n    }\n    // 添加floorPosition\n    let floorPos = 0;\n    const speedEvents = this.speedEvents!;\n    for (let i = 0; i < speedEvents.length; i++) {\n      const startTime = Math.max(speedEvents[i].time, 0);\n      const endTime = i < speedEvents.length - 1 ? speedEvents[i + 1].time : 1e9;\n      const value = speedEvents[i].value * 11 / 45;\n      const floorPosition = floorPos;\n      floorPos += (endTime - startTime) * value / this.bpm * 1.875;\n      floorPos = Math.fround(floorPos);\n      result.speedEvents.push({ startTime, endTime, value, floorPosition });\n    }\n    // 处理notes\n    const sortFn = (a: { time: number }, b: { time: number }) => a.time - b.time;\n    for (const i of this.notes.sort(sortFn)) {\n      const { time } = i;\n      let v1 = 0;\n      let v2 = 0;\n      let v3 = 0;\n      for (const e of result.speedEvents) {\n        if (time > e.endTime) continue;\n        if (time < e.startTime) break;\n        v1 = e.floorPosition;\n        v2 = e.value;\n        v3 = time - e.startTime;\n      }\n      const note = {\n        type: i.type,\n        time: time + (i.isFake ? 1e9 : 0),\n        positionX: i.positionX,\n        holdTime: i.holdTime,\n        speed: i.speed * (i.type === 3 ? v2 : 1),\n        floorPosition: Math.fround(v1 + v2 * v3 / this.bpm * 1.875)\n      };\n      if (i.isAbove) {\n        result.notesAbove.push(note);\n        if (i.isFake) continue;\n        result.numOfNotes++;\n        result.numOfNotesAbove++;\n      } else {\n        result.notesBelow.push(note);\n        if (i.isFake) continue;\n        result.numOfNotes++;\n        result.numOfNotesBelow++;\n      }\n    }\n    return result;\n  }\n}\ninterface RPEMeta {\n  RPEVersion: string;\n  song: string;\n  background: string;\n  name: string;\n  composer: string;\n  charter: string;\n  level: string;\n  offset: number;\n}\ninterface RPEDataBase {\n  BPMList: BpmEventRPEExtends[];\n  judgeLineList: JudgeLineRPEExtends[];\n}\ntype RPEDataLegacy = RPEDataBase & RPEMeta & { META: undefined };\ntype RPEDataCurrent = RPEDataBase & { META: RPEMeta };\ntype RPEData = RPEDataCurrent | RPEDataLegacy;\ninterface JudgeLineRPE {\n  numOfNotes: number;\n  isCover: number;\n  Texture: string;\n  eventLayers: (EventLayer | null)[];\n  extended?: {\n    scaleXEvents: LineEventRPE[];\n    scaleYEvents: LineEventRPE[];\n  } | null;\n  notes: NoteRPE[] | null;\n  Group: number;\n  Name: string;\n  zOrder: number;\n  bpmfactor: number;\n  father: number;\n}\ninterface JudgeLineRPEExtends extends JudgeLineRPE {\n  LineId: number;\n  judgeLineRPE: LineRPE1;\n}\nexport function parse(pec: string, filename: string): {\n  data: string;\n  messages: string[];\n  info: ChartInfoData;\n  line: ChartLineData[];\n} {\n  const data = JSON.parse(pec) as RPEData;\n  const meta = data.META || data;\n  if (!meta?.RPEVersion) throw new Error('Invalid rpe file');\n  const result = { formatVersion: 3, offset: 0, numOfNotes: 0, judgeLineList: [] as JudgeLine[] };\n  const warnings = [];\n  warnings.push(`RPE谱面兼容建设中...\\n检测到RPE版本:${meta.RPEVersion}\\n来自${filename}`);\n  // 谱面信息\n  const info: ChartInfoData = {};\n  info.Chart = filename;\n  info.Music = meta.song;\n  info.Image = meta.background;\n  info.Name = meta.name;\n  info.Artist = meta.composer;\n  info.Charter = meta.charter;\n  info.Level = meta.level;\n  result.offset = meta.offset / 1e3;\n  // 判定线贴图\n  const line: ChartLineData[] = [];\n  data.judgeLineList.forEach((i: JudgeLineRPEExtends, index: number) => {\n    i.LineId = index;\n    const texture = String(i.Texture).replace(/\\0/g, '');\n    if (texture === 'line.png') return;\n    const { extended } = i;\n    const scaleX = extended?.scaleXEvents ? extended.scaleXEvents[extended.scaleXEvents.length - 1].end : 1;\n    const scaleY = extended?.scaleYEvents ? extended.scaleYEvents[extended.scaleYEvents.length - 1].end : 1;\n    line.push({\n      Chart: filename,\n      LineId: index,\n      Image: texture,\n      Scale: scaleY,\n      Aspect: scaleX / scaleY,\n      UseBackgroundDim: 0,\n      UseLineColor: 1,\n      UseLineScale: 1\n    });\n  });\n  // bpm变速\n  const bpmList = new BpmList(data.BPMList[0].bpm);\n  for (const i of data.BPMList) { i.time = i.startTime[0] + i.startTime[1] / i.startTime[2] }\n  data.BPMList.sort((a: { time: number }, b: { time: number }) => a.time - b.time).forEach((i, idx, arr) => {\n    if (arr[idx + 1]?.time <= 0) return; // 过滤负数\n    bpmList.push(i.time < 0 ? 0 : i.time, arr[idx + 1]?.time ?? 1e9, i.bpm);\n  });\n  for (const i of data.judgeLineList) {\n    if (i.zOrder === undefined) i.zOrder = 0;\n    if (i.bpmfactor === undefined) i.bpmfactor = 1;\n    if (i.father === undefined) i.father = -1;\n    if (i.isCover !== 1) { warnings.push(`未兼容isCover=${i.isCover}(可能无法正常显示)\\n位于${i.LineId}号判定线\\n来自${filename}`) }\n    if (i.zOrder !== 0) { warnings.push(`未兼容zOrder=${i.zOrder}(可能无法正常显示)\\n位于${i.LineId}号判定线\\n来自${filename}`) }\n    if (i.bpmfactor !== 1) { warnings.push(`未兼容bpmfactor=${i.bpmfactor}(可能无法正常显示)\\n位于${i.LineId}号判定线\\n来自${filename}`) }\n    const lineRPE = new LineRPE1(bpmList.baseBpm);\n    lineRPE.setId(i.LineId);\n    if (i.notes) {\n      for (const note of i.notes) {\n        if (note.alpha === undefined) note.alpha = 255;\n        // if (note.above !== 1 && note.above !== 2) warnings.push(`检测到非法方向:${note.above}(将被视为2)\\n位于:\"${JSON.stringify(note)}\"\\n来自${filename}`);\n        if (note.isFake !== 0) warnings.push(`检测到FakeNote(可能无法正常显示)\\n位于:\"${JSON.stringify(note)}\"\\n来自${filename}`);\n        if (note.size !== 1) warnings.push(`未兼容size=${note.size}(可能无法正常显示)\\n位于:\"${JSON.stringify(note)}\"\\n来自${filename}`);\n        if (note.yOffset !== 0) warnings.push(`未兼容yOffset=${note.yOffset}(可能无法正常显示)\\n位于:\"${JSON.stringify(note)}\"\\n来自${filename}`);\n        if (note.visibleTime !== 999999) warnings.push(`未兼容visibleTime=${note.visibleTime}(可能无法正常显示)\\n位于:\"${JSON.stringify(note)}\"\\n来自${filename}`);\n        if (note.alpha !== 255) warnings.push(`未兼容alpha=${note.alpha}(可能无法正常显示)\\n位于:\"${JSON.stringify(note)}\"\\n来自${filename}`);\n        const type = [0, 1, 4, 2, 3].indexOf(note.type);\n        const time = bpmList.calc2(note.startTime);\n        const holdTime = bpmList.calc2(note.endTime) - time;\n        const { speed } = note;\n        const positionX = note.positionX / 75.375;\n        lineRPE.pushNote(type, time, positionX, holdTime, speed, note.above === 1, note.isFake !== 0);\n      }\n    }\n    for (const e of i.eventLayers) {\n      if (!e) continue; // 有可能是null\n      const layer = new EventLayer1();\n      for (const j of e.moveXEvents ?? []) {\n        const startTime = bpmList.calc2(j.startTime);\n        const endTime = bpmList.calc2(j.endTime);\n        const easingResult = getEasingFn(j, startTime, endTime);\n        if (easingResult.code === EasingCode.EasingTypeNotSupported && j.easingType !== 1) {\n          warnings.push(`未知的缓动类型:${j.easingType}(将被视为1)\\n位于:\"${JSON.stringify(j)}\"\\n来自${filename}`);\n        }\n        layer.pushMoveXEvent(startTime, endTime, j.start, j.end, easingResult.fn);\n      }\n      for (const j of e.moveYEvents ?? []) {\n        const startTime = bpmList.calc2(j.startTime);\n        const endTime = bpmList.calc2(j.endTime);\n        const easingResult = getEasingFn(j, startTime, endTime);\n        if (easingResult.code === EasingCode.EasingTypeNotSupported && j.easingType !== 1) {\n          warnings.push(`未知的缓动类型:${j.easingType}(将被视为1)\\n位于:\"${JSON.stringify(j)}\"\\n来自${filename}`);\n        }\n        layer.pushMoveYEvent(startTime, endTime, j.start, j.end, easingResult.fn);\n      }\n      for (const j of e.rotateEvents ?? []) {\n        const startTime = bpmList.calc2(j.startTime);\n        const endTime = bpmList.calc2(j.endTime);\n        const easingResult = getEasingFn(j, startTime, endTime);\n        if (easingResult.code === EasingCode.EasingTypeNotSupported && j.easingType !== 1) {\n          warnings.push(`未知的缓动类型:${j.easingType}(将被视为1)\\n位于:\"${JSON.stringify(j)}\"\\n来自${filename}`);\n        }\n        layer.pushRotateEvent(startTime, endTime, j.start, j.end, easingResult.fn);\n      }\n      for (const j of e.alphaEvents ?? []) {\n        const startTime = bpmList.calc2(j.startTime);\n        const endTime = bpmList.calc2(j.endTime);\n        const easingResult = getEasingFn(j, startTime, endTime);\n        if (easingResult.code === EasingCode.EasingTypeNotSupported && j.easingType !== 1) {\n          warnings.push(`未知的缓动类型:${j.easingType}(将被视为1)\\n位于:\"${JSON.stringify(j)}\"\\n来自${filename}`);\n        }\n        layer.pushAlphaEvent(startTime, endTime, j.start, j.end, easingResult.fn);\n      }\n      for (const j of e.speedEvents ?? []) {\n        const startTime = bpmList.calc2(j.startTime);\n        const endTime = bpmList.calc2(j.endTime);\n        layer.pushSpeedEvent(startTime, endTime, j.start, j.end);\n      }\n      lineRPE.eventLayers.push(layer);\n    }\n    i.judgeLineRPE = lineRPE;\n  }\n  for (const i of data.judgeLineList) {\n    const lineRPE = i.judgeLineRPE; // TODO: 待优化\n    const father = data.judgeLineList[i.father];\n    lineRPE.setFather(father?.judgeLineRPE);\n  }\n  for (const i of data.judgeLineList) {\n    const lineRPE = i.judgeLineRPE; // TODO: 待优化\n    const judgeLine = lineRPE.format({ onwarning: (msg: string) => warnings.push(`${msg}\\n来自${filename}`) });\n    result.judgeLineList.push(judgeLine);\n    result.numOfNotes += judgeLine.numOfNotes;\n  }\n  return { data: JSON.stringify(result), messages: warnings, info, line };\n}\n","import { parse } from './pec2json';\nimport { parse as parseRPE } from './rpe2json';\n// 读取info.txt\nfunction readInfo(text: string): Record<string, string>[] {\n  const lines = String(text).split(/\\r?\\n/);\n  const result = [];\n  let current = {} as Record<string, string>;\n  for (const i of lines) {\n    if (i.startsWith('#')) {\n      if (Object.keys(current).length) result.push(current);\n      current = {};\n    } else {\n      let [key, value] = i.split(/:(.+)/).map(s => s.trim());\n      if (key === 'Song') key = 'Music';\n      if (key === 'Picture') key = 'Image';\n      if (key) current[key] = value;\n    }\n  }\n  if (Object.keys(current).length) result.push(current);\n  return result;\n}\nexport default { parse, parseRPE, readInfo };\n","import { isLinear } from './easing.js';\nimport { BpmList } from './BpmList';\nimport { LinePec } from './LinePec';\ninterface BpmCommand {\n  time: number;\n  bpm: number;\n}\ninterface NoteCommand {\n  type: number;\n  lineId: number;\n  time: number;\n  time2: number;\n  offsetX: number;\n  isAbove: number;\n  isFake: number;\n  text: string;\n  speed: number;\n  size: number;\n}\ninterface LineCommand {\n  type: string;\n  lineId: number;\n  time: number;\n  time2: number;\n  speed: number;\n  offsetX: number;\n  offsetY: number;\n  rotation: number;\n  alpha: number;\n  motionType: number;\n  text: string;\n}\ninterface PecParseResult {\n  data: string;\n  messages: string[];\n}\nexport function parse(pec: string, filename: string): PecParseResult {\n  const data = pec.split(/\\s+/); // 切分pec文本\n  const data2 = {\n    offset: 0,\n    bpmList: [] as BpmCommand[],\n    notes: [] as NoteCommand[],\n    lines: [] as LineCommand[]\n  };\n  const result = {\n    formatVersion: 3,\n    offset: 0,\n    numOfNotes: 0,\n    judgeLineList: [] as JudgeLine[]\n  };\n  const warnings = []; //\n  let ptr = 0;\n  data2.offset = isNaN(Number(data[ptr])) ? 0 : Number(data[ptr++]);\n  while (ptr < data.length) {\n    const command = data[ptr++];\n    if (command === '') { continue }\n    if (command === 'bp') {\n      const time = Number(data[ptr++]);\n      const bpm = Number(data[ptr++]);\n      data2.bpmList.push({ time, bpm });\n    } else if (command.startsWith('n')) {\n      if (!'1234'.includes(command[1])) { throw new Error(`Unsupported Command: ${command}`) }\n      const cmd = {} as NoteCommand;\n      const type = command[1];\n      cmd.type = Number(type);\n      cmd.lineId = Number(data[ptr++]);\n      cmd.time = Number(data[ptr++]);\n      cmd.time2 = '2'.includes(type) ? Number(data[ptr++]) : cmd.time;\n      cmd.offsetX = Number(data[ptr++]);\n      cmd.isAbove = Number(data[ptr++]);\n      cmd.isFake = Number(data[ptr++]);\n      cmd.text = `n${Object.values(cmd).join(' ')}`;\n      cmd.speed = (data[ptr++] || '').startsWith('#') ? Number(data[ptr++]) : (ptr--, 1);\n      cmd.size = (data[ptr++] || '').startsWith('&') ? Number(data[ptr++]) : (ptr--, 1);\n      data2.notes.push(cmd);\n    } else if (command.startsWith('c')) {\n      if (!'vpdamrf'.includes(command[1])) { throw new Error(`Unsupported Command: ${command}`) }\n      const cmd = {} as LineCommand;\n      const type = command[1];\n      cmd.type = type;\n      cmd.lineId = Number(data[ptr++]);\n      cmd.time = Number(data[ptr++]);\n      if ('v'.includes(type)) { cmd.speed = Number(data[ptr++]) }\n      cmd.time2 = 'mrf'.includes(type) ? Number(data[ptr++]) : cmd.time;\n      if ('pm'.includes(type)) { cmd.offsetX = Number(data[ptr++]) }\n      if ('pm'.includes(type)) { cmd.offsetY = Number(data[ptr++]) }\n      if ('dr'.includes(type)) { cmd.rotation = Number(data[ptr++]) }\n      if ('af'.includes(type)) { cmd.alpha = Number(data[ptr++]) }\n      if ('mr'.includes(type)) { cmd.motionType = Number(data[ptr++]) }\n      cmd.text = `c${Object.values(cmd).join(' ')}`;\n      if ('pdaf'.includes(type)) { cmd.motionType = 1 }\n      data2.lines.push(cmd);\n    } else { throw new Error(`Unexpected Command: ${command}`) }\n  }\n  result.offset = data2.offset / 1e3 - 0.175; // v18x固定延迟\n  // bpm变速\n  if (!data2.bpmList.length) { throw new Error('Invalid pec file') }\n  const bpmList = new BpmList(data2.bpmList[0].bpm); // FIXME: 考虑合适的bpm范围\n  data2.bpmList.sort((a, b) => a.time - b.time).forEach((i, idx, arr) => {\n    if (arr[idx + 1]?.time <= 0) { return } // 过滤负数\n    bpmList.push(i.time < 0 ? 0 : i.time, arr[idx + 1]?.time ?? 1e9, i.bpm);\n  });\n  // note和判定线事件\n  const linesPec = [] as LinePec[];\n  for (const i of data2.notes) {\n    const type = [0, 1, 4, 2, 3].indexOf(i.type);\n    const time = bpmList.calc(i.time);\n    const holdTime = bpmList.calc(i.time2) - time;\n    const speed = isNaN(i.speed) ? 1 : i.speed;\n    linesPec[i.lineId] ??= new LinePec(bpmList.baseBpm);\n    linesPec[i.lineId].pushNote(type, time, i.offsetX / 115.2, holdTime, speed, i.isAbove === 1, i.isFake !== 0); // 102.4\n    // if (i.isAbove !== 1 && i.isAbove !== 2) warnings.push(`检测到非法方向:${i.isAbove}(将被视为2)\\n位于:\"${i.text}\"\\n来自${filename}`);\n    if (i.isFake !== 0) {\n      warnings.push(`检测到FakeNote(可能无法正常显示)\\n位于:\"${i.text}\"\\n来自${filename}`);\n    }\n    if (i.size !== 1) { warnings.push(`检测到异常Note(可能无法正常显示)\\n位于:\"${i.text}\"\\n来自${filename}`) }\n  }\n  const isMotion = (i: number) => !isLinear(i) || i === 1;\n  for (const i of data2.lines) {\n    const t1 = bpmList.calc(i.time);\n    const t2 = bpmList.calc(i.time2);\n    if (t1 > t2) {\n      warnings.push(`检测到开始时间大于结束时间(将禁用此事件)\\n位于:\"${i.text}\"\\n来自${filename}`);\n      continue;\n    }\n    linesPec[i.lineId] ??= new LinePec(bpmList.baseBpm);\n    // 变速\n    if (i.type === 'v') {\n      linesPec[i.lineId].pushSpeedEvent(t1, i.speed / 7.0); // 6.0??\n    }\n    // 不透明度\n    if (i.type === 'a' || i.type === 'f') {\n      linesPec[i.lineId].pushAlphaEvent(t1, t2, Math.max(i.alpha / 255, 0), i.motionType); // 暂不支持alpha值扩展\n      if (i.alpha < 0) { warnings.push(`检测到负数Alpha:${i.alpha}(将被视为0)\\n位于:\"${i.text}\"\\n来自${filename}`) }\n    }\n    // 移动\n    if (i.type === 'p' || i.type === 'm') {\n      linesPec[i.lineId].pushMoveEvent(t1, t2, i.offsetX / 2048, i.offsetY / 1400, isMotion(i.motionType) ? i.motionType : 1);\n      if (!isMotion(i.motionType)) { warnings.push(`未知的缓动类型:${i.motionType}(将被视为1)\\n位于:\"${i.text}\"\\n来自${filename}`) }\n    }\n    // 旋转\n    if (i.type === 'd' || i.type === 'r') {\n      linesPec[i.lineId].pushRotateEvent(t1, t2, -i.rotation, isMotion(i.motionType) ? i.motionType : 1);\n      if (!isMotion(i.motionType)) { warnings.push(`未知的缓动类型:${i.motionType}(将被视为1)\\n位于:\"${i.text}\"\\n来自${filename}`) }\n    }\n  }\n  for (const i of linesPec) {\n    const judgeLine = i.format();\n    result.judgeLineList.push(judgeLine);\n    result.numOfNotes += judgeLine.numOfNotes;\n  }\n  return { data: JSON.stringify(result), messages: warnings };\n}\n","import Pec from '../extends/pec/index';\nimport { chart123, defineReader, fileReader, joinPathInfo } from './reader';\nimport md5 from 'md5';\nfileReader.use(defineReader({\n  pattern: /\\.(json|pec)$/i,\n  type: 'json',\n  read(i: ByteData) {\n    const rpeData = Pec.parseRPE(i.text!, i.name/* , path */); // TODO: path\n    const jsonData = chart123(rpeData.data);\n    const { messages: msg, info, line } = rpeData;\n    return { type: 'chart', name: i.name, md5: md5(i.text!), data: jsonData, msg, info, line };\n  }\n}));\nfileReader.use(defineReader({\n  pattern: /\\.pec$/i,\n  type: 'text',\n  read(i: ByteData) {\n    const pecData = Pec.parse(i.text!, i.name);\n    const jsonData = chart123(pecData.data);\n    return { type: 'chart', name: i.name, md5: md5(i.text!), data: jsonData, msg: pecData.messages };\n  }\n}));\nfileReader.use(defineReader({\n  pattern: /^(Settings|info)\\.txt$/i,\n  type: 'text',\n  mustMatch: true,\n  read(i: ByteData, path: string) {\n    const data = i.text!;\n    const chartInfo = joinPathInfo(Pec.readInfo(data), path);\n    return { type: 'info' as const, data: chartInfo };\n  }\n}));\nif (Object.hasOwn(self, 'webp')) {\n  fileReader.use(defineReader({\n    pattern: /\\.webp$/i,\n    type: 'binary',\n    async read(i: ByteData) {\n      const webp2canvas = Object.getOwnPropertyDescriptor(self, 'webp')?.value.default as (buffer: ArrayBuffer) => Promise<HTMLCanvasElement>;\n      const img = await webp2canvas(i.buffer);\n      const bitmap = await createImageBitmap(img);\n      return { type: 'image', name: i.name, data: bitmap };\n    }\n  }));\n}\n// fileReader.use(defineReader({\n//   pattern: /^\\.ogg$/i,\n//   type: 'binary',\n//   async read(i: ByteData) {\n//     const { OggVorbisDecoder } = await import('@wasm-audio-decoders/ogg-vorbis');\n//     const decoder = new OggVorbisDecoder();\n//     await decoder.ready;\n//     const { channelData, samplesDecoded, sampleRate } = await decoder.decodeFile(new Uint8Array(i.buffer));\n//     decoder.free();\n//     const actx = new (window.AudioContext || window.webkitAudioContext)();\n//     const ab = actx.createBuffer(channelData.length, samplesDecoded, sampleRate);\n//     channelData.forEach((channel, idx) => ab.getChannelData(idx).set(channel));\n//     return { type: 'audio', name: i.name, data: { audio: ab, video: null } };\n//   }\n// }));\n"],"names":["tl","t","Math","sin","PI","cos","sqrt","easing","index","trunc","BpmList","constructor","baseBpm","__publicField","this","Number","accTime","list","push","start","end","bpm","value","calc","beat","time","i","round","calc2","LinePec","speedEvents","notes","alphaEvents","moveEvents","rotateEvents","isNaN","pushNote","type","positionX","holdTime","speed","isAbove","isFake","pushSpeedEvent","pushAlphaEvent","startTime","endTime","motionType","pushMoveEvent","value2","pushRotateEvent","format","sortFn","s","a","b","sortFn2","result","formatVersion","offset","numOfNotes","numOfNotesAbove","numOfNotesBelow","notesAbove","notesBelow","judgeLineDisappearEvents","judgeLineMoveEvents","judgeLineRotateEvents","pushDisappearEvent","c","start2","end2","m","o","cvp","sort","s1","length","max","floorPosition","fround","v1","v2","v3","e","note","dt","d1","easingFn","t1","x1","x2","mt","m1","m2","t2","rt","r1","cubicBezier","p1x","p1y","p2x","p2y","ax","bx","cx","ay","by","cy","sampleCurveDerivativeX","sampleCurveX","solve","x","sampleCurveY","derivative","abs","t0","solveCurveX","getEasingFn","le","bezier","code","easingType","easingLeft","easingRight","eHead","eTail","eSpeed","eDelta","fn","bezierPoints","Error","pushLineEvent","ls","delta","j","getEventsValue","d","_ref2","_a","getMoveValue","_ref3","_ref4","result2","_b","getRotateValue","_ref5","combineMultiEvents","es","splits","reduce","n","EventLayer1","moveXEvents","moveYEvents","pushMoveXEvent","pushMoveYEvent","LineRPE1","eventLayers","father","settled","merged","setId","id","NaN","setFather","fatherLine","preset","events","map","xe","ye","startX","endX","startY","endY","combineXYEvents","toSpeedEvent","fitFather","stack","onwarning","console","warn","includes","concat","join","child","fatherX","fatherY","fatherR","fatherX2","fatherY2","fatherR2","childX","childY","childX2","childY2","mergeFather","floorPos","Pec","pec","filename","data","split","data2","bpmList","lines","judgeLineList","warnings","ptr","command","startsWith","cmd","lineId","time2","offsetX","text","Object","values","size","offsetY","rotation","alpha","forEach","idx","arr","_ref","linesPec","_u$l","indexOf","isMotion","isLinear","_u$p","judgeLine","JSON","stringify","messages","parseRPE","parse","meta","META","RPEVersion","info","Chart","Music","song","Image","background","Name","name","Artist","composer","Charter","charter","Level","level","line","LineId","texture","String","Texture","replace","extended","scaleX","scaleXEvents","scaleY","scaleYEvents","Scale","Aspect","UseBackgroundDim","UseLineColor","UseLineScale","BPMList","_ref6","zOrder","bpmfactor","isCover","lineRPE","yOffset","visibleTime","above","layer","_p$moveXEvents","easingResult","_p$moveYEvents","_p$rotateEvents","_p$alphaEvents","_p$speedEvents","judgeLineRPE","msg","readInfo","current","keys","key","trim","fileReader","use","defineReader","pattern","read","rpeData","jsonData","chart123","md5","pecData","mustMatch","path","joinPathInfo","hasOwn","self","img","getOwnPropertyDescriptor","default","buffer","bitmap","createImageBitmap"],"mappings":"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"}