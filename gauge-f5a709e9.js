const e=hook.define({name:"Gauge",description:"Apply gauge",contents:[{type:"config",meta:["启用收集条",function(e,s){e.addEventListener("change",(()=>{e.checked?(hook.now.set("gauge",h),hook.after.set("gauge",c)):(hook.now.delete("gauge"),hook.after.delete("gauge"))})),t.reg("enableGauge",e)}]}]}),{status:t,stat:s,app:o}=hook;const a=[null,0,0,0,0,0,0,0];let i=0,n=0;const d={value:100,delta:-1,speedInit:0,speed:0,speed2:0,factor:.5,factor2:Math.SQRT1_2,dead:!1,tick(e){this.dead||(this.delta=this.speedInit*e,this.delta+=this.speed*(1-this.factor**e),this.delta+=this.speed2*(1-this.factor2**e),this.value=Math.min(100,this.value+this.delta),this.delta/=e||1/0,this.value<=0&&(this.dead=!0),this.speed*=this.factor**e,this.speed2*=this.factor2**e)},reset(){this.value=100,this.delta=-1,this.speedInit=0,this.speed=0,this.speed2=0,this.factor=.5,this.factor2=Math.SQRT1_2,this.dead=!1}};function h(e){if(a[0]!==o.chart&&function(){const{chart:e}=o;d.reset(),i=function(e,t){let o=0;return o=e<400?80/e+.2:e<600?32/e+.2:96/e+.08,s.level>=16&&(o*=.8),o}(e.numOfNotes),d.speedInit=-i*e.numOfNotes/(o.bgMusic.duration+.5),console.log("initGauge"),a[0]=e;for(let e=1;e<8;e++)a[e]=s.noteRank[e]}(),d.dead){for(const e of o.notes)e.scored||(e.status=2,s.addCombo(2,e.type),e.scored=!0);return void(hook.time=o.bgMusic.duration)}const{noteRank:t}=s;t[6]>a[6]&&(d.speed2-=18),t[5]>a[5]&&(d.speed+=i*(t[5]-a[5])),t[4]>a[4]&&(d.speed+=i*(t[4]-a[4])*2),t[1]>a[1]&&(d.speed+=i*(t[1]-a[1])),t[2]>a[2]&&(d.speed2-=18);for(let e=1;e<8;e++)a[e]=s.noteRank[e];hook.playing&&d.tick(e-n),n=e}function c(){const e=d.value/100,t=d.delta,s=`rgba(${255*u(-t)},${255*u(1+t)},${255*u(1+t)},1)`;l("#3f3b71",1),l(s,e)}function l(e,t){const{ctxfg:s,canvasfg:a,lineScale:i}=o;s.fillStyle=e,s.fillRect(a.width/2-6*i*u(t),.2*i,12*i*u(t),.2*i)}function u(e){return e<0?0:e>1?1:e}export{e as default};
//# sourceMappingURL=gauge-f5a709e9.js.map
